<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" type="text/css" href="stylesheet.css">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <title>Alternate Transit</title>
	<h1> <center>Alternate Transit Via Google Maps </center></h1>

    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script> 
<!--	<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=false&v=3&libraries=geometry"></script> !-->
 <script>
var directionsDisplay;
var directionsService = new google.maps.DirectionsService();
var map;
var bahen = new google.maps.LatLng(43.6596, -79.3972);

var transportFactors = {
		'WALKING': 1.0,
		'BICYCLING': 0.5,
		'SKATEBOARDING': 0.65,
		'SWIMMING': 0.9,
		'RUNNING': 0.75,
		'SPEED-WALKING': 0.7
	}

function initialize() {
  directionsDisplay = new google.maps.DirectionsRenderer();
  
  var mapOptions = {
    zoom: 17,
    center: bahen
  }
  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
  directionsDisplay.setMap(map);
  directionsDisplay.setPanel(document.getElementById('directionsPanel'));
  
  google.maps.event.addListener(directionsDisplay, 'directions_changed', function() {
  computeTotalDistance(directionsDisplay.directions);
  computeTotalTime(directionsDisplay.directions);  

  });


}

function calcRoute() {
  var start = document.getElementById('start').value;
  var end = document.getElementById('end').value;  
  
  var request = {
      origin: start,
      destination: end,
      // Note that Javascript allows us to access the constant
      // using square brackets and a string value as its
      // "property."
      travelMode: google.maps.TravelMode.WALKING
  };
  

  directionsService.route(request, function(response, status) {
    if (status == google.maps.DirectionsStatus.OK) {
      directionsDisplay.setDirections(response);
    } 	
  });
  
}

function computeTotalDistance(result) {

  var total = 0;
  var myroute = result.routes[0];
  for (var i = 0; i < myroute.legs.length; i++) {
    total += myroute.legs[i].distance.value;
  }
  total = total / 1000.0;
  document.getElementById('totalDist').innerHTML = total + ' km';
  return total;
  
}
 
function checkTimes (totalMins, totalSecs) {
  var totalMinutes, totalSeconds, totalTime;
  
  if (totalMins == 1) {
	totalMinutes = parseInt(totalMins) + 'min ';
  }  
  
  else if (totalMins > 1) {
	
	totalMinutes = parseInt(totalMins) + 'mins ';
  }

  else if (totalMins == 0) {
    totalMinutes = "";
  }
  
   else {
	totalMinutes = "";
  }
   
  
  if (totalSecs == 1) {
	totalSeconds = totalSecs + 'sec';
  }  
  
  else if (totalSecs > 1) {
	totalSeconds = totalSecs + 'secs';
  }
  
  else if (totalSecs == 0) {
    totalSeconds = "";
  }
  
  if ((totalSeconds == "") && (totalMinutes == "")) {
	totalMinutes = "";
	totalSeconds = "0 secs";
  }
  
  
  totalTime = [totalMinutes, totalSeconds];
  return totalTime;

}

function computeTotalTime(result) {

  var total = 0;
  var myroute = result.routes[0];
  var totalTimes;
  for (var i = 0; i < myroute.legs.length; i++) {
    total += myroute.legs[i].duration.value;
  }
  
  total = total * transportFactors[document.getElementById('mode').value];
  totalMins = total / 60.0;
  totalSecs = parseInt((totalMins % 1) * 60);
  
  totalTimes = checkTimes(totalMins, totalSecs)
  totalMins = totalTimes[0];
  totalSecs = totalTimes[1];
  
  
  
  document.getElementById('totalMins').innerHTML = totalMins + totalSecs;

  return total;
  
}
google.maps.event.addDomListener(window, 'load', initialize);

    </script>
  </head>
  <body>
  <div id="map-canvas"></div> 
    <div id="input-panel">
	<br>
	<div id="text">
    <b>Mode of Travel: </b>
    <select id="mode" onchange="computeTotalTime(directionsDisplay.directions);">
      <option value="WALKING">Walking</option>
      <option value="BICYCLING">Bicycling</option>
      <option value="RUNNING">Running</option>
	  <option value="SKATEBOARDING">Skateboarding</option>
	  <option value="SWIMMING">Swimming</option>
	  <option value="SPEED-WALKING">Speed Walking</option>
	  
    </select>
	
	<br>
	<br>
	<b>Start: </b>
    <select id="start" onchange="calcRoute();">
      <option value="43.6596, -79.3972">Bahen Centre</option>
      <option value="43.6644, -79.3994">Robarts Library</option>
      <option value="43.660888, -79.399931">Bancroft Building</option>
      <option value="43.662114, -79.398563">Sidney Smith</option>
      <option value="43.65843, -79.392814">Exam Centre</option>
      <option value="43.662673, -79.395162">University College</option>
      <option value="43.659015, -79.392846">Health Sciences Building</option>
      <option value="43.661853, -79.398009">Lash Miller</option>
      <option value="43.660885, -79.398706">McLennan Physical</option>
	  
    </select>
	<br>
	<br>
    <b> End: </b>
    <select id="end" onchange="calcRoute();">
      <option value="43.6596, -79.3972">Bahen Centre</option>
      <option value="43.6644, -79.3994">Robarts Library</option>
      <option value="43.660888, -79.399931">Bancroft Building</option>
      <option value="43.662114, -79.398563">Sidney Smith</option>
      <option value="43.65843, -79.392814">Exam Centre</option>
      <option value="43.662673, -79.395162">University College</option>
      <option value="43.659015, -79.392846">Health Sciences Building</option>
      <option value="43.661853, -79.398009">Lash Miller</option>
      <option value="43.660885, -79.398706">McLennan Physical</option>
	  
	  </select>
	<br>
	
	<p> <b> Distance: </b> <span id="totalDist"> </span> </p>
	<p> <b> Time: </b> <span id="totalMins"></span></p>
	
	</div>
    </div>
	<p id="name"> Created by Anam Alvi and Jahid Ahmed 2014 &#169; </p>
    
  </body>
</html>